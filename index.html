<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Football Legendary - Online Bot & VS</title>
    <style>
        :root { --p1-color: #2196F3; --p2-color: #f44336; }
        body { margin: 0; padding: 0; overflow: hidden; background: #121212; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; touch-action: none; }
        #game-container { position: relative; width: 95vw; height: 53.43vw; max-height: 95vh; max-width: 168.88vh; background: #2e7d32; border: 4px solid white; border-radius: 8px; overflow: hidden; }
        canvas { width: 100%; height: 100%; display: block; }
        .menu-layer { position: absolute; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 50; color: white; text-align: center; }
        .btn { padding: 12px 30px; font-size: 1.2vw; cursor: pointer; border: none; color: white; border-radius: 50px; font-weight: bold; margin: 5px; min-width: 180px; transition: 0.2s; }
        .btn-green { background: #4CAF50; } .btn-blue { background: #2196F3; } .btn-red { background: #f44336; }
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; color: white; font-size: 2vw; font-weight: bold; z-index: 10; pointer-events: none; }
        #countdown { position: absolute; color: #ffeb3b; font-size: 80px; font-weight: bold; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; z-index: 15; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui">MAVİ: <span id="s1">0</span> | KIRMIZI: <span id="s2">0</span></div>
    
    <div id="main-menu" class="menu-layer">
        <h1>FOOTBALL LEGENDARY</h1>
        <button class="btn btn-green" onclick="startOnline('pvp', 0, 0, 12, 1)">2 OYUNCU (VS)</button>
        <button class="btn btn-blue" onclick="showDifficulty()">BOTA KARŞI</button>
    </div>

    <div id="difficulty-menu" class="menu-layer" style="display: none;">
        <h1>ZORLUK SEÇ</h1>
        <button class="btn btn-green" onclick="startOnline('bot', 0.07, 8, 11, 1)">KOLAY</button>
        <button class="btn btn-blue" onclick="startOnline('bot', 0.16, 13, 17, 1)">ORTA</button>
        <button class="btn btn-red" onclick="startOnline('bot', 0.35, 19, 17, 2)">ZOR (2 TOP!)</button>
    </div>

    <div id="countdown">3</div>
    <canvas id="game"></canvas>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const countEl = document.getElementById("countdown");

canvas.width = 1280; canvas.height = 720;
let myId, mySide, players = {}, balls = [], myY = 300;

socket.on('init', (data) => {
    myId = data.id; mySide = data.side;
});

socket.on('update', (data) => {
    players = data.players;
    balls = data.balls;
    document.getElementById("s1").innerText = data.scores.left;
    document.getElementById("s2").innerText = data.scores.right;
    draw();
});

socket.on('goal', () => {
    countEl.style.display = "block";
    let t = 3; countEl.innerText = t;
    let inv = setInterval(() => {
        t--;
        if(t <= 0) { clearInterval(inv); countEl.style.display = "none"; }
        else countEl.innerText = t;
    }, 1000);
});

function startOnline(mode, skill, speed, bSpeed, bCount) {
    document.querySelectorAll('.menu-layer').forEach(m => m.style.display = 'none');
    socket.emit('startConfig', {
        isBotMode: mode === 'bot',
        botSkill: skill,
        botSpeed: speed,
        ballSpeed: bSpeed,
        ballCount: bCount
    });
}

function showDifficulty() {
    document.getElementById("main-menu").style.display = "none";
    document.getElementById("difficulty-menu").style.display = "flex";
}

window.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    const scaleY = 720 / rect.height;
    myY = (e.clientY - rect.top) * scaleY - 60;
    socket.emit('move', { y: myY });
});

function draw() {
    ctx.clearRect(0, 0, 1280, 720);
    ctx.strokeStyle = "rgba(255,255,255,0.3)";
    ctx.lineWidth = 5;
    ctx.strokeRect(0, 0, 1280, 720);
    ctx.beginPath(); ctx.moveTo(640, 0); ctx.lineTo(640, 720); ctx.stroke();

    Object.values(players).forEach(p => {
        ctx.fillStyle = p.side === 'left' ? "#2196F3" : "#f44336";
        ctx.fillRect(p.side === 'left' ? 40 : 1220, p.y, 20, 120);
    });

    ctx.fillStyle = "white";
    balls.forEach(ball => {
        ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill();
    });
}
</script>
</body>
</html>

